# 九宫格分镜板方案提示词

## 📋 方案概述

本目录包含九宫格分镜板生成方案的所有提示词模板。该方案通过一次性生成3x3九宫格分镜板，替代原有的9次独立生成，实现：

- ✅ **成本降低 40-55%** - 1次API调用替代9次
- ✅ **视觉连续性完美** - 天然保证所有分镜风格一致
- ✅ **生成速度提升 9倍** - 并发处理多个场景
- ✅ **质量保证** - 4K分辨率，切割后每格720p高清

---

## 📁 文件说明

### 1. `场景提取提示词.txt`
**用途**: 将小说章节拆分为电影场景

**输入**: 
- 小说章节内容
- 已存在角色列表

**输出**: 
```json
{
  "scenes": [
    {
      "order_index": 1,
      "scene": "场景描述",
      "characters": ["角色名1", "角色名2"],
      "scene_type": "dialogue|action|establishing",
      "estimated_duration": "60-90秒"
    }
  ]
}
```

**关键改进**:
- 新增 `scene_type` 字段，便于后续分镜策略选择
- 新增 `estimated_duration` 字段，确保场景适合9个分镜
- 强调每个场景应容纳9个连续流畅的分镜

---

### 2. `九宫格分镜板生成提示词.txt`
**用途**: 将场景拆分为9个连续分镜，生成分镜板JSON

**输入**:
- 场景描述
- 已存在角色列表
- 场景ID

**输出**:
```json
{
  "storyboard": {
    "scene_id": "xxx",
    "total_shots": 9,
    "grid_layout": "3x3",
    "visual_continuity_theme": "统一视觉风格描述",
    "shots": [
      {
        "grid_position": "top-left",
        "order_index": 1,
        "shot_description": "详细画面描述",
        "camera_work": "镜头类型",
        "lighting": "光线描述",
        "dialogue": "对话内容",
        "characters": ["角色名"],
        "visual_connection_to_next": "与下一格的衔接点"
      }
      // ... 共9个
    ]
  }
}
```

**核心特性**:
- **固定9个分镜** - 严格控制数量
- **视觉连续性设计** - 统一光线、色调、角色外观
- **分镜衔接点** - 明确每格之间的视觉连接
- **分镜拆分策略** - 提供对话/动作/环境场景的模板

---

### 3. `九宫格图像生成提示词.txt`
**用途**: 给AI图像模型的提示词，生成4K九宫格图像

**输入**:
- 从步骤2生成的分镜板JSON
- 填充到模板的各个字段

**输出**:
- 3840×2160像素的4K九宫格图像
- 每个格子1280×720像素（720p）

**关键要求**:
- **严格布局控制** - 3×3网格，清晰边框
- **格子编号** - 每格左上角标注1-9
- **真人摄影风格** - 禁止CGI/3D/动画
- **视觉一致性** - 所有格子统一光线和色调

---

## 🔄 完整工作流程

```
步骤1: 场景提取
小说章节 → [场景提取提示词] → 场景JSON列表

步骤2: 九宫格分镜设计
场景描述 → [九宫格分镜板生成提示词] → 分镜板JSON

步骤3: 九宫格图像生成
分镜板JSON → [构建图像提示词] → 4K九宫格图像

步骤4: 图像切割
4K九宫格 → [3×3切割] → 9张720p图片

步骤5: 视频生成
每张图片 → [图生视频] → 8秒视频

步骤6: 视频拼接
9个视频 → [拼接] → 完整场景视频（72秒）
```

---

## 💡 使用建议

### 场景类型选择

**对话场景** (scene_type: "dialogue"):
```
格子1: 建立镜头
格子2-3: 角色A说话
格子4-5: 角色B回应
格子6-7: 互动细节
格子8: 情绪转折
格子9: 结束画面
```

**动作场景** (scene_type: "action"):
```
格子1: 动作起始
格子2-4: 动作展开
格子5-6: 冲突高潮
格子7-8: 结果呈现
格子9: 余波
```

**环境展示** (scene_type: "establishing"):
```
格子1: 远景建立
格子2-4: 环境细节
格子5-6: 氛围元素
格子7-8: 角色进入
格子9: 场景稳定
```

---

## ⚠️ 注意事项

### 1. 提示词控制精度
- 九宫格生成对提示词要求更高
- 需要明确每个格子的内容和位置
- 建议多次测试优化提示词

### 2. 图像切割鲁棒性
- 开发固定位置切割算法（快速）
- 添加边界检测功能（提升鲁棒性）
- 切割后检查每张图片质量

### 3. 质量保障
- 生成后检查九宫格布局是否正确
- 验证每个格子内容是否符合预期
- 如有问题，调整提示词重新生成

### 4. 分辨率优化
- 4K九宫格 → 切割后720p（标准HD）
- 如需1080p，可使用Real-ESRGAN超分辨率
- 或直接生成6K九宫格（每格1920×1080）

---

## 📊 与原方案对比

| 特性 | 原方案 | 九宫格方案 |
|------|--------|-----------|
| API调用次数 | 9次/场景 | 1次/场景 |
| 成本 | 基准 | -40~55% |
| 视觉连续性 | 依赖参考 | 天然一致 |
| 生成速度 | 基准 | 9倍提升 |
| 提示词复杂度 | 简单 | 较复杂 |
| 失败影响 | 单帧 | 整体 |
| 分辨率 | 1920×1080 | 1280×720 |

---

## 🎯 最佳实践

1. **先小规模验证**
   - 选择3-5个典型场景测试
   - 评估九宫格生成效果
   - 优化提示词模板

2. **分场景类型处理**
   - 简单对话 → 九宫格方案
   - 复杂动作 → 评估后决定
   - 特写镜头 → 可能需要独立生成

3. **质量监控**
   - 记录每次生成的成功率
   - 收集失败案例优化提示词
   - 建立质量评分标准

4. **成本追踪**
   - 对比新旧方案实际成本
   - 计算ROI和节省比例
   - 持续优化成本效益

---

## 🔧 技术实现参考

```python
# 伪代码示例

# 步骤1: 场景提取
scenes = extract_scenes(chapter_content, characters)

# 步骤2: 生成九宫格分镜板
for scene in scenes:
    storyboard_json = generate_storyboard(scene, characters)
    
    # 步骤3: 构建图像提示词
    image_prompt = build_image_prompt(storyboard_json)
    
    # 步骤4: 生成4K九宫格
    grid_image = image_ai.generate(
        prompt=image_prompt,
        resolution="3840x2160"
    )
    
    # 步骤5: 切割九宫格
    shot_images = split_grid(grid_image, grid_size=(3, 3))
    
    # 步骤6: 生成视频
    videos = []
    for i, shot_img in enumerate(shot_images):
        video = video_ai.generate(
            image=shot_img,
            prompt=storyboard_json['shots'][i]['shot_description'],
            duration=8
        )
        videos.append(video)
    
    # 步骤7: 拼接视频
    final_video = concatenate_videos(videos)
```

---

## 📝 版本历史

- **v1.0** (2026-01-05)
  - 初始版本
  - 包含场景提取、九宫格分镜板生成、图像生成三个核心提示词
  - 基于原有提示词优点进行优化和扩展
