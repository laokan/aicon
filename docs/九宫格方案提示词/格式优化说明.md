# 九宫格分镜板提示词格式优化说明

## 📋 优化目标

简化JSON输出格式，减少字段数量，将所有分镜信息整合到单个 `shot` 字段中，便于存储和处理。

---

## 🔄 格式对比

### ❌ **优化前（7个字段）**

```json
{
  "order_index": 1,
  "grid_position": "top-left",
  "shot_description": "详细的画面描述",
  "camera_work": "镜头类型和运动",
  "lighting": "光线描述",
  "dialogue": "角色对话内容",
  "characters": ["角色名1"],
  "visual_connection_to_next": "与下一格的视觉衔接点"
}
```

**问题**：
- 字段过多，数据库存储复杂
- 信息分散，不利于阅读和理解
- 与现有系统的 `MovieShot` 模型不匹配

---

### ✅ **优化后（4个字段）**

```json
{
  "order_index": 1,
  "shot": "完整的分镜描述（包含运镜、光线、画面、动作、视觉衔接等所有信息）",
  "dialogue": "角色对话内容",
  "characters": ["角色名1"]
}
```

**优势**：
- ✅ 字段精简，只保留必要信息
- ✅ 所有描述性信息整合到 `shot` 字段
- ✅ 完全兼容现有 `MovieShot` 模型
- ✅ 便于存储和查询

---

## 📝 Shot字段整合规范

### 必需元素（按顺序整合）

1. **运镜方式**（放在开头）
   ```
   格式：[运镜名称]: [运镜描述]
   示例：Slow push in: 镜头缓慢推进...
         FPV drone shot: 穿越机镜头高速穿梭...
         Dolly zoom: 希区柯克变焦效果...
   ```

2. **光线与氛围**
   ```
   光线条件：golden hour sunlight, dramatic shadows
   色调：warm tones, cool tones, high contrast
   天气：clear sky, rainy, foggy
   ```

3. **起始画面状态**
   ```
   角色位置、姿态、表情
   环境元素、道具位置
   构图和景别
   ```

4. **连续可见动作**（8秒内完成）
   ```
   具体的肢体动作、位置变化
   物体移动、环境变化
   表情和情绪的视觉呈现
   ```

5. **结束画面状态**
   ```
   动作完成后的最终姿态
   画面稳定状态
   视觉衔接点（为下一格铺垫）
   ```

---

## 🎬 完整示例

### 示例1：动作场景

```json
{
  "order_index": 1,
  "shot": "FPV drone shot: 穿越机镜头从城门外高速穿入，以第一人称视角展现梅露希亚的队伍逼近。夜色中火把的光在雨幕中摇曳，营造紧张氛围。镜头快速穿过半掩的城门，在狭窄空间中灵活机动，最终定格在梅露希亚从队伍前方走出的画面。她停在城门外数步之遥，抬头望向阿尔德里克，雨水顺着她的盔甲流淌。镜头稳定在她坚定的表情上，为对话做好准备。",
  "dialogue": "",
  "characters": ["梅露希亚 (Melusia)"]
}
```

### 示例2：对话场景

```json
{
  "order_index": 2,
  "shot": "Over-the-shoulder shot: 从梅露希亚的肩膀后方拍摄，柔和的雨雾光线。画面前景是梅露希亚的侧影，背景中阿尔德里克站在城门内，表情疲惫但警惕。镜头缓慢推进，焦点从梅露希亚转移到阿尔德里克的脸部特写，捕捉他眼神中的复杂情绪。最终画面定格在阿尔德里克的特写，他的眼神从惊讶转为警惕，为下一格的回应做好铺垫。",
  "dialogue": "我以为你已经死在北境了。",
  "characters": ["梅露希亚 (Melusia)", "阿尔德里克"]
}
```

### 示例3：情绪高潮

```json
{
  "order_index": 5,
  "shot": "Dolly zoom (Vertigo Effect): 希区柯克变焦效果。镜头向前推进的同时变焦拉远，背景城墙和环境急剧拉伸，营造眩晕和震惊感。阿尔德里克的脸部保持同样大小，但背景扭曲变形，视觉上强化他内心的震撼。暴雨在扭曲的背景中倾泻，光影剧烈变化。他的表情从平静转为震惊，眼神中流露出复杂的情绪。最终画面稳定在他震惊的特写上，为情绪爆发做好铺垫。",
  "dialogue": "",
  "characters": ["阿尔德里克"]
}
```

---

## ✅ 优化效果

### 数据库兼容性
```python
# 现有 MovieShot 模型完全兼容
class MovieShot(BaseModel):
    scene_id = Column(...)
    order_index = Column(Integer)
    shot = Column(Text)           # ✅ 整合后的完整描述
    dialogue = Column(Text)        # ✅ 保留
    characters = Column(JSON)      # ✅ 保留
    keyframe_url = Column(...)
```

### 存储优化
- **优化前**：7个字段，需要额外的数据库列或JSON解析
- **优化后**：4个字段，直接映射到现有模型

### 可读性提升
- **优化前**：需要组合多个字段才能理解完整分镜
- **优化后**：单个 `shot` 字段即可完整阅读

### AI生成质量
- **优化前**：AI可能在不同字段间产生不一致
- **优化后**：AI在单个字段内保持连贯性更强

---

## 🔧 迁移建议

### 对于新项目
直接使用优化后的格式，无需任何调整。

### 对于现有数据
如果已有使用旧格式的数据，可以通过简单的脚本合并：

```python
def migrate_old_format(old_shot):
    """将旧格式迁移到新格式"""
    shot_parts = []
    
    # 1. 运镜
    if old_shot.get('camera_work'):
        shot_parts.append(old_shot['camera_work'])
    
    # 2. 光线
    if old_shot.get('lighting'):
        shot_parts.append(old_shot['lighting'])
    
    # 3. 画面描述
    if old_shot.get('shot_description'):
        shot_parts.append(old_shot['shot_description'])
    
    # 4. 视觉衔接
    if old_shot.get('visual_connection_to_next'):
        shot_parts.append(f"视觉衔接：{old_shot['visual_connection_to_next']}")
    
    return {
        'order_index': old_shot['order_index'],
        'shot': '. '.join(shot_parts),
        'dialogue': old_shot.get('dialogue', ''),
        'characters': old_shot.get('characters', [])
    }
```

---

## 📊 总结

| 维度 | 优化前 | 优化后 | 改进 |
|------|--------|--------|------|
| 字段数量 | 7个 | 4个 | -43% |
| 数据库列 | 需要额外列 | 完全兼容 | ✅ |
| 可读性 | 分散 | 集中 | ✅ |
| 存储效率 | 较低 | 较高 | ✅ |
| AI生成质量 | 可能不一致 | 更连贯 | ✅ |

**结论**：优化后的格式更简洁、更高效、更易于维护，完全兼容现有系统架构。
